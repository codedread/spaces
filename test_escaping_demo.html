<!DOCTYPE html>
<html>
<head>
    <title>HTML Escaping Bug Fix Demo</title>
</head>
<body>
    <h1>HTML Escaping Bug Fix Demo</h1>
    
    <div id="test-container">
        <h2>Before Fix (Vulnerable):</h2>
        <div id="before-fix" style="border: 1px solid red; padding: 10px; margin: 10px 0;"></div>
        
        <h2>After Fix (Safe):</h2>
        <div id="after-fix" style="border: 1px solid green; padding: 10px; margin: 10px 0;"></div>
    </div>

    <script type="module">
        import { utils } from './js/utils.js';
        
        // Simulate the bug scenario with tab titles containing HTML
        const maliciousTitle = '<input> element';
        const anotherExample = '<script>alert("XSS")<\/script>';
        
        // Before fix: Directly setting innerHTML (creates actual HTML elements)
        const beforeFixDiv = document.getElementById('before-fix');
        beforeFixDiv.innerHTML = `
            <p>Tab title (creates HTML elements): ${maliciousTitle}</p>
            <p>Script injection (creates script tag): ${anotherExample}</p>
        `;
        
        // After fix: Using escapeHtml function (displays as text)
        const afterFixDiv = document.getElementById('after-fix');
        afterFixDiv.innerHTML = `
            <p>Tab title (displays as text): ${utils.escapeHtml(maliciousTitle)}</p>
            <p>Script injection (safe text): ${utils.escapeHtml(anotherExample)}</p>
        `;
        
        console.log('Original title:', maliciousTitle);
        console.log('Escaped title:', utils.escapeHtml(maliciousTitle));
        console.log('Input elements in before-fix div:', beforeFixDiv.querySelectorAll('input').length);
        console.log('Input elements in after-fix div:', afterFixDiv.querySelectorAll('input').length);
    </script>
</body>
</html>
